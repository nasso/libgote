<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Entity and Component - libgote</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="expanded "><a href="../concepts.html"><strong aria-hidden="true">2.</strong> Concepts</a></li><li><ol class="section"><li class="expanded "><a href="../concepts/state.html"><strong aria-hidden="true">2.1.</strong> State</a></li><li class="expanded "><a href="../concepts/world-resource.html"><strong aria-hidden="true">2.2.</strong> World and Resource</a></li><li class="expanded "><a href="../concepts/entity-component.html" class="active"><strong aria-hidden="true">2.3.</strong> Entity and Component</a></li><li class="expanded "><a href="../concepts/system.html"><strong aria-hidden="true">2.4.</strong> System</a></li><li class="expanded "><a href="../concepts/dispatcher.html"><strong aria-hidden="true">2.5.</strong> Dispatcher</a></li><li class="expanded "><a href="../concepts/event_channel.html"><strong aria-hidden="true">2.6.</strong> Event channel</a></li><li class="expanded "><a href="../concepts/asset_format.html"><strong aria-hidden="true">2.7.</strong> Asset format</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">libgote</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#entity-and-resource" id="entity-and-resource">Entity and Resource</a></h1>
<h2><a class="header" href="#entity" id="entity">Entity</a></h2>
<p>An entity represents any object of your game. Examples of entities include the
player, NPCs, an item, a button or a map. An entity doesn't hold any data (other
than its existence)! Essentially, entities can be thought of as elements in a
big array containing all the objects that make up a scene of your game:</p>
<table><thead><tr><th>player</th><th>villager</th><th>sword</th><th>play_button</th></tr></thead><tbody>
</tbody></table>
<h2><a class="header" href="#component" id="component">Component</a></h2>
<p>A component is what gives <em>properties</em> to an entity. Without components,
entities are... Well, useless! They don't do anything! They don't even have a
<em>position</em>, a <em>color</em>, a <em>sprite</em>... All this information comes from components.</p>
<p>At any given point, an entity either <em>has</em> or <em>doesn't have</em> a component. It
cannot have, say, the same component twice. Keeping the example from above, it's
as if each component type added one new line to the following table:</p>
<table><thead><tr><th align="center"></th><th align="center">entity</th></tr></thead><tbody>
<tr><td align="center">Component A</td><td align="center">value 1</td></tr>
<tr><td align="center">Component B</td><td align="center">value 2</td></tr>
<tr><td align="center">Component C</td><td align="center">value 3</td></tr>
</tbody></table>
<p>Entities are not required to have a value for all component types. For example,
we could say that the player only needs a position and a sprite:</p>
<table><thead><tr><th align="center"></th><th align="center">player</th></tr></thead><tbody>
<tr><td align="center">Position</td><td align="center">(3, 4)</td></tr>
<tr><td align="center">Sprite</td><td align="center">player.png</td></tr>
<tr><td align="center">Color</td><td align="center">-</td></tr>
</tbody></table>
<p>The player doesn't have a &quot;color&quot;, so the value for the &quot;color&quot; component line
is just left empty.</p>
<p>Adding an entity adds a column to the table!</p>
<table><thead><tr><th align="center"></th><th align="center">player</th><th align="center">villager</th><th align="center">sword</th><th align="center">play_button</th></tr></thead><tbody>
<tr><td align="center">Position</td><td align="center">(3, 4)</td><td align="center">(17, 12)</td><td align="center">(-4, 1)</td><td align="center">(40, 160)</td></tr>
<tr><td align="center">Sprite</td><td align="center">player.png</td><td align="center">villager.png</td><td align="center">sword.png</td><td align="center">-</td></tr>
<tr><td align="center">Color</td><td align="center">-</td><td align="center">-</td><td align="center">-</td><td align="center">#88FF00</td></tr>
</tbody></table>
<p>Even if only one entity requires a &quot;color&quot; component the line for the &quot;color&quot;
component spans all the table. That can create &quot;holes&quot; in the table, but it's
okay because there are ways to eliminate that problem we will see very shortly.</p>
<h2><a class="header" href="#usage-with-the-libgote" id="usage-with-the-libgote">Usage with the <code>libgote</code></a></h2>
<h3><a class="header" href="#creating-a-component-class" id="creating-a-component-class">Creating a component class</a></h3>
<p>Say you want to create a new kind of component. For this example, we will create
a &quot;position&quot; component class.</p>
<p>The first step is to declare a new <a href="https://nasso.io/libgote/doc/component_8h.html#a6739e0f3cea04059f731821731848abf"><code>gt_component_class_t</code></a> global constant.
Usually, you will want to declare it in a header file with the <code>extern</code> keyword:</p>
<pre><code class="language-c">extern const gt_component_class_t POSITION_COMP;
</code></pre>
<p>And then, define it in your source file:</p>
<pre><code class="language-c">const gt_component_class_t POSITION_COMP = {
  .name = &quot;position_component&quot;,
  .destroyer = &amp;my_free,
};
</code></pre>
<p>There are two important fields here:</p>
<ul>
<li><code>name</code> - a static, <em><strong>unique</strong></em> character string that will be used as the key
for the storage resource in the world. It <strong>must be unique</strong> and must <strong>not
be used as the key for any other resource in the world</strong>.</li>
<li><code>destroyer</code> - a pointer to the function to be called when the component data
is to be destroyed.</li>
</ul>
<p>Speaking about the component data: it can be anything you want! It is common to
have a constructor for your component data (declared in the same header file as
the <a href="https://nasso.io/libgote/doc/component_8h.html#a6739e0f3cea04059f731821731848abf"><code>gt_component_class_t</code></a> it corresponds to):</p>
<pre><code class="language-c">typedef struct {
  f64_t x;
  f64_t y;
} position_comp_t;

position_comp_t *position_component(f64_t x, f64_t y);
</code></pre>
<p>An example implementation could be:</p>
<pre><code class="language-c">position_comp_t *position_component(f64_t x, f64_t y)
{
  position_comp_t *self = my_calloc(1, sizeof(position_comp_t));

  self-&gt;x = x;
  self-&gt;y = y;
  return (self);
}
</code></pre>
<h3><a class="header" href="#registering-components" id="registering-components">Registering components</a></h3>
<p>Components are stored in <em>&quot;storages&quot;</em> kept as a <a href="world-resource.html#resource">Resource</a> in the <a href="world-resource.html#world">World</a>. Think
of a storage as a simple array (that's basically what they are anyway).  Keeping
the table example from earlier, each component &quot;storage&quot; corresponds to a line
of the table. That means there's one storage per component type.</p>
<table><thead><tr><th align="center"></th><th align="center">player</th><th align="center">villager</th><th align="center">sword</th><th align="center">play_button</th></tr></thead><tbody>
<tr><td align="center">Position</td><td align="center">(3, 4)</td><td align="center">(17, 12)</td><td align="center">(-4, 1)</td><td align="center">(40, 160)</td></tr>
<tr><td align="center">Sprite</td><td align="center">player.png</td><td align="center">villager.png</td><td align="center">sword.png</td><td align="center">-</td></tr>
<tr><td align="center">Color</td><td align="center">-</td><td align="center">-</td><td align="center">-</td><td align="center">#88FF00</td></tr>
</tbody></table>
<p>In this example, there are 3 storages: one for <code>Position</code> components, one for
<code>Sprite</code> components and another for <code>Color</code> components. Each line is a storage.</p>
<p>There are two implementations of storage in the <code>libgote</code>:</p>
<ul>
<li><a href="https://nasso.io/libgote/doc/storage_8h.html#a840ee612a9d9f0e18173aa76a5c00157"><code>gt_vec_storage</code></a> - literally just a vector: better when most entities will
have this component (there's very few &quot;holes&quot;).</li>
<li><a href="https://nasso.io/libgote/doc/storage_8h.html#a1734e440a07ce6d8bc21b053a2f2cc7d"><code>gt_map_storage</code></a> - uses a hash map: better when few entities will have this
component (there are many, big &quot;holes&quot;). <strong>Not implemented as of writing this.
Do not use.</strong></li>
</ul>
<p>As a component storage is just a resource in the world, you add them just like
any other resource:</p>
<pre><code class="language-c">// create the storage (here it's just a vector/array!)
gt_storage_t *strg = gt_vec_storage();

gt_world_insert(
  world,
  POSITION_COMP.name,
  strg,
  (void (*)(void*)) &amp;gt_storage_destroy
);
</code></pre>
<p>Though, having to do that for every component type would be kinda annoying. This
is why the <a href="https://nasso.io/libgote/doc/world_8h.html#a38a9c2aac83d56af536247b9b195c26a"><code>gt_world_register</code></a> function exists! It takes care of the last
argument (the destroyer):</p>
<pre><code class="language-c">gt_storage_t *strg = gt_vec_storage();

gt_world_register(world, POSITION_COMP.name, strg);
</code></pre>
<p>But there's even better than this! The <a href="https://nasso.io/libgote/doc/world_8h.html#ac219c2fa113e399980f9f05391fef06e"><code>gt_world_register_component</code></a> function!</p>
<pre><code class="language-c">gt_world_register_component(world, &amp;POSITION_COMP, &amp;gt_vec_storage);
</code></pre>
<p>Here, all you have to give is a pointer to the <a href="https://nasso.io/libgote/doc/component_8h.html#a6739e0f3cea04059f731821731848abf"><code>gt_component_class_t</code></a> and a
pointer to the constructor for the storage implementation to use. It does the
exact same thing as the code snippets above!</p>
<h3><a class="header" href="#creating-an-entity" id="creating-an-entity">Creating an entity</a></h3>
<p>You cannot create an entity from nothing (there's no &quot;<code>gt_entity_create</code>&quot;
function). The reason for this is that an entity only makes sense when it is
part of a world, with the appropriate storages available.</p>
<p>You can create entities with the <a href="https://nasso.io/libgote/doc/world_8h.html#ad152d8ee4d09746e01e3610507ffcb18"><code>gt_world_create_entity</code></a> function:</p>
<p>The arguments are:</p>
<ul>
<li>The world</li>
<li>How many components to initialize the entity with</li>
<li>For each initial component:
<ul>
<li>A pointer to the <a href="https://nasso.io/libgote/doc/component_8h.html#a6739e0f3cea04059f731821731848abf"><code>gt_component_class_t</code></a></li>
<li>The component data</li>
</ul>
</li>
</ul>
<p>For example, to create an entity using our <code>position_comp_t</code>:</p>
<pre><code class="language-c">gt_entity_t *ent = gt_world_create_entity(world, 1,
  &amp;POSITION_COMP, position_component(2.0, 6.0)
);
</code></pre>
<p>Or with more components you've created (don't forget to change the component
count!):</p>
<pre><code class="language-c">gt_entity_t *player = gt_world_create_entity(world, 3,
  &amp;POSITION_COMP, position_component(2.0, 6.0),
  &amp;SPRITE_COMP, sprite_component(&quot;player.png&quot;),
  &amp;INVENTORY_COMP, inventory_component()
);
</code></pre>
<p>Of course, if you want to create an entity without any component:</p>
<pre><code class="language-c">gt_entity_t *ent = gt_world_create_entity(world, 0);
</code></pre>
<h3><a class="header" href="#removing-the-entity" id="removing-the-entity">Removing the entity</a></h3>
<p>When you're done using an entity, you have to manually remove it from the world!
<a href="state.html">State</a>s do not know about the entities you've created, so they are not removed
automatically!</p>
<p>To remove entities, use the <a href="https://nasso.io/libgote/doc/world_8h.html#a1cdb28dd5c3b8de2a578aaf832abdebe"><code>gt_world_remove_entity</code></a> function:</p>
<pre><code class="language-c">/* Remove the player entity when the state stops */
static void combat_state_on_stop(void *ptr, gt_world_t *world)
{
  struct combat_state *self = ptr;

  gt_world_remove_entity(world, self-&gt;player);
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../concepts/world-resource.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../concepts/system.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../concepts/world-resource.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../concepts/system.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
